{% extends 'layout.html' %}
{% load static %}

{% block title %}Accessories - EcoPet{% endblock %}

{% block extrahead %}
  <link rel="stylesheet" href="{% static 'css/styleAll.css' %}">
  <style>
    .accessories-page {
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background: #C3E684;
      border: 2px solid #28963D;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }
    .accessories-layout {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .pet-display {
      flex: 1;
      background: #fff;
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
    .pet-display video,
    .pet-display img {
      width: 100%;
      max-width: 300px;
      border-radius: 50%;
      border: 3px solid #98DABA;
      margin-bottom: 10px;
      transition: transform 0.3s ease;
    }
    .pet-display video:hover,
    .pet-display img:hover {
      transform: scale(1.05);
    }
    .pet-display h3 {
      font-size: 1.5em;
      color: #106A1A;
    }
    .accessories-content {
      flex: 2;
      background: #fff;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
    .accessories-page h1 {
      text-align: center;
      color: #106A1A;
      margin-bottom: 10px;
      font-size: 2.8em;
    }
    .accessories-page p.subheading {
      text-align: center;
      color: #28963D;
      margin-bottom: 30px;
      font-size: 1.2em;
    }
    .accessories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
    }
    .accessory-card {
      background: #F9F9F9;
      border: 1px solid #80CD27;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
      transition: transform 0.3s ease;
      cursor: pointer;
    }
    .accessory-card:hover {
      transform: translateY(-3px);
    }
    .accessory-card img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin-bottom: 8px;
    }
    .accessory-card h3 {
      font-size: 1.1em;
      color: #106A1A;
      margin-bottom: 5px;
    }
    .accessory-card p {
      font-size: 0.9em;
      color: #28963D;
      margin-bottom: 8px;
    }
    .buy-btn {
      background-color: #7ED08F;
      color: #fff;
      padding: 6px 12px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.9em;
      transition: background-color 0.3s, transform 0.2s;
      display: inline-block;
      margin-top: 8px;
    }
    .buy-btn:hover {
      background-color: #28963D;
      transform: translateY(-2px);
    }
    .back-to-pet {
      display: block;
      text-align: center;
      margin: 30px auto 0;
      padding: 10px 20px;
      background-color: #7ED08F;
      color: #fff;
      text-decoration: none;
      border-radius: 8px;
      transition: background-color 0.3s, transform 0.2s;
      width: fit-content;
    }
    .back-to-pet:hover {
      background-color: #28963D;
      transform: translateY(-3px);
    }
  </style>
  <script>
    // sort functionality for accessories
    document.addEventListener("DOMContentLoaded", function(){
      const sortSelect = document.getElementById("sortSelect");
      sortSelect.addEventListener("change", function(){
        const sortValue = this.value;
        const grid = document.querySelector(".accessories-grid");
        let cards = Array.from(grid.getElementsByClassName("accessory-card"));
        cards.sort((a, b) => {
          let aValue, bValue;
          if (sortValue === "price-asc") {
            aValue = parseFloat(a.getAttribute("data-price") || 0);
            bValue = parseFloat(b.getAttribute("data-price") || 0);
            return aValue - bValue;
          } else if (sortValue === "price-desc") {
            aValue = parseFloat(a.getAttribute("data-price") || 0);
            bValue = parseFloat(b.getAttribute("data-price") || 0);
            return bValue - aValue;
          } else if (sortValue === "popular") {
            aValue = parseFloat(a.getAttribute("data-popular") || 0);
            bValue = parseFloat(b.getAttribute("data-popular") || 0);
            return bValue - aValue;
          } else if (sortValue === "newest") {
            aValue = new Date(a.getAttribute("data-newest") || "1970-01-01");
            bValue = new Date(b.getAttribute("data-newest") || "1970-01-01");
            return bValue - aValue;
          }
        });
        cards.forEach(card => grid.removeChild(card));
        cards.forEach(card => grid.appendChild(card));
      });
    });

    function equipAccessory(accessoryName) {
      const petDisplay = document.getElementById("petDisplay");
      const petType = petDisplay.getAttribute("data-pet-type") || "axolotl";
      let videoSrc = "";
      if (accessoryName === "glasses") {
        if (petType === "axolotl") {
          videoSrc = "/media/pets/base_movs/axolotl/axolotlglasses.webm";
        } else if (petType === "virginiabigearedbat") {
          videoSrc = "/media/pets/base_movs/bat/batglasses.webm";
        } else if (petType === "africanbushelephant") {
          videoSrc = "/media/pets/base_movs/elephant/elephantglasses.webm";
        }
      } else if (accessoryName === "cowboy") {
        if (petType === "axolotl") {
          videoSrc = "/media/pets/base_movs/axolotl/axolotlcowboy.webm";
        } else if (petType === "virginiabigearedbat") {
          videoSrc = "/media/pets/base_movs/bat/batcowboy.webm";
        } else if (petType === "africanbushelephant") {
          videoSrc = "/media/pets/base_movs/elephant/elephantcowboy.webm";
        }
      } else if (accessoryName === "plant") {
        if (petType === "axolotl") {
          videoSrc = "/media/pets/base_movs/axolotl/axolotlplant.webm";
        } else if (petType === "virginiabigearedbat") {
          videoSrc = "/media/pets/base_movs/bat/batplant.webm";
        } else if (petType === "africanbushelephant") {
          videoSrc = "/media/pets/base_movs/elephant/elephantplant.webm";
        }
      }
      const petVideo = document.getElementById("petVideo");
      if (petVideo) {
        while (petVideo.firstChild) {
          petVideo.removeChild(petVideo.firstChild);
        }
        const newSource = document.createElement("source");
        newSource.src = videoSrc;
        newSource.type = "video/webm";
        petVideo.appendChild(newSource);
        petVideo.load();
      }
    }
  </script>
{% endblock %}

{% block content %}
<div class="accessories-page">
  <h1>Accessory Shop</h1>
  <p class="subheading">Dress up your pet with exclusive accessories! Click an item to equip it instantly.</p>
  
  <div class="accessories-layout">
    <div class="pet-display" id="petDisplay" data-pet-type="{% if pet %}{{ pet.type.name|lower|cut:" "|cut:"-" }}{% else %}axolotl{% endif %}">
      <h2>Your Pet</h2>
      <video id="petVideo" autoplay loop playsinline muted style="width: 100%; max-width: 300px; border-radius: 50%; border: 3px solid #98DABA; margin-bottom: 10px;">
        {% if pet %}
          {% with pet_type=pet.type.name|lower|cut:" "|cut:"-" %}
            {% if pet.type.name == "Axolotl" %}
              <source src="/media/pets/base_movs/axolotl/axolotl.webm" type="video/webm">
            {% elif pet.type.name == "Virginia Big-Eared Bat" %}
              <source src="/media/pets/base_movs/bat/bat.webm" type="video/webm">
            {% elif pet.type.name == "African Bush Elephant" %}
              <source src="/media/pets/base_movs/elephant/elephant.webm" type="video/webm">
            {% endif %}
          {% endwith %}
        {% else %}
          <source src="/media/pets/base_movs/axolotl/axolotl.webm" type="video/webm">
        {% endif %}
        Your browser does not support the video tag.
      </video>
      <h3>{% if pet %}{{ pet.name }}{% else %}Default Pet{% endif %}</h3>
    </div>
    
    <div class="accessories-content">
      <div class="sort-options">
        <label for="sortSelect">Sort by: </label>
        <select id="sortSelect">
          <option value="price-asc">Price: Low to High</option>
          <option value="price-desc">Price: High to Low</option>
          <option value="popular">Most Popular</option>
          <option value="newest">Newest</option>
        </select>
      </div>
      
      <div class="accessories-grid">
        <div class="accessory-card" onclick="equipAccessory('cowboy')" data-price="100" data-popular="50" data-newest="2025-01-01">
          <img src="/media/pets/accessories_icon/cowboy.png" alt="Cowboy Hat">
          <h3>Cowboy Hat</h3>
          <p>Equip for a stylish cowboy look!</p>
        </div>

        <div class="accessory-card" onclick="equipAccessory('glasses')" data-price="0" data-popular="70" data-newest="2025-01-01">
          <img src="/media/pets/accessories_icon/glasses.png" alt="Glasses">
          <h3>Glasses</h3>
          <p>Equip these cool glasses!</p>
        </div>

        <div class="accessory-card" onclick="equipAccessory('plant')" data-price="150" data-popular="40" data-newest="2025-01-01">
          <img src="/media/pets/accessories_icon/plant.png" alt="Plant Hat">
          <h3>Plant Hat</h3>
          <p>Equip for a nature style!</p>
        </div>
      </div>
    </div>
  </div>
  <a href="{% url 'pets:mypet' %}" class="back-to-pet">Back to My Pet</a>
</div>
{% endblock %}
