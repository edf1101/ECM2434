{% extends 'layout.html' %}
{% load static %}

{% block title %}Accessories - EcoPet{% endblock %}

{% block extrahead %}
  <link rel="stylesheet" href="{% static 'css/styleAll.css' %}">
  <style>
    .accessories-page {
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background: #C3E684;
      border: 2px solid #28963D;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }
    .accessories-layout {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .pet-display {
      flex: 1 1 300px;
      background: #fff;
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
    .pet-display img {
      width: 100%;
      max-width: 300px;
      border-radius: 50%;
      border: 3px solid #98DABA;
      margin-bottom: 10px;
      transition: transform 0.3s ease;
    }
    .pet-display img:hover {
      transform: scale(1.05);
    }
    .accessories-content {
      flex: 2 1 600px;
      background: #fff;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
    .accessories-page h1 {
      text-align: center;
      color: #106A1A;
      margin-bottom: 10px;
      font-size: 2.8em;
    }
    .accessories-page p.subheading {
      text-align: center;
      color: #28963D;
      margin-bottom: 30px;
      font-size: 1.2em;
    }
    .accessories-nav {
      margin-bottom: 15px;
    }
    .accessories-nav .nav-link {
      color: #106A1A;
      font-weight: bold;
      font-size: 1em;
      padding: 8px 12px;
      border-radius: 8px;
    }
    .accessories-nav .nav-link.active {
      background-color: #7ED08F;
      color: #fff;
    }
    /* Sort Options */
    .sort-options {
      text-align: center;
      margin-bottom: 20px;
    }
    .sort-options select {
      padding: 8px 12px;
      border: 1px solid #80CD27;
      border-radius: 6px;
      font-size: 1em;
    }
    /* accessories grid */
    .accessories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
    }
    .accessory-card {
      background: #F9F9F9;
      border: 1px solid #80CD27;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
      transition: transform 0.3s ease;
    }
    .accessory-card:hover {
      transform: translateY(-3px);
    }
    .accessory-card img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin-bottom: 8px;
    }
    .accessory-card h3 {
      font-size: 1.1em;
      color: #106A1A;
      margin-bottom: 5px;
    }
    .accessory-card p {
      font-size: 0.9em;
      color: #28963D;
      margin-bottom: 8px;
    }
    .buy-btn {
      background-color: #7ED08F;
      color: #fff;
      padding: 6px 12px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.9em;
      transition: background-color 0.3s, transform 0.2s;
      display: inline-block;
      margin-top: 8px;
    }
    .buy-btn:hover {
      background-color: #28963D;
      transform: translateY(-2px);
    }
    .back-to-pet {
      display: block;
      text-align: center;
      margin: 30px auto 0;
      padding: 10px 20px;
      background-color: #7ED08F;
      color: #fff;
      text-decoration: none;
      border-radius: 8px;
      transition: background-color 0.3s, transform 0.2s;
      width: fit-content;
    }
    .back-to-pet:hover {
      background-color: #28963D;
      transform: translateY(-3px);
    }
  </style>
  <script>
    // sort functionality
    document.addEventListener("DOMContentLoaded", function(){
      const sortSelect = document.getElementById("sortSelect");
      sortSelect.addEventListener("change", function(){
        const sortValue = this.value;
        const grid = document.querySelector(".accessories-grid");
        // get accessory cards as an array
        let cards = Array.from(grid.getElementsByClassName("accessory-card"));
        cards.sort((a, b) => {
          let aValue, bValue;
          if (sortValue === "price-asc") {
            aValue = parseFloat(a.getAttribute("data-price") || 0);
            bValue = parseFloat(b.getAttribute("data-price") || 0);
            return aValue - bValue;
          } else if (sortValue === "price-desc") {
            aValue = parseFloat(a.getAttribute("data-price") || 0);
            bValue = parseFloat(b.getAttribute("data-price") || 0);
            return bValue - aValue;
          } else if (sortValue === "popular") {
            aValue = parseFloat(a.getAttribute("data-popular") || 0);
            bValue = parseFloat(b.getAttribute("data-popular") || 0);
            return bValue - aValue;
          } else if (sortValue === "newest") {
            aValue = new Date(a.getAttribute("data-newest") || "1970-01-01");
            bValue = new Date(b.getAttribute("data-newest") || "1970-01-01");
            return bValue - aValue;
          }
        });
        // clear current cards
        cards.forEach(card => grid.removeChild(card));
        // append cards in sorted order
        cards.forEach(card => grid.appendChild(card));
      });
    });
  </script>
{% endblock %}

{% block content %}
<div class="accessories-page">
  <h1>Accessory Shop</h1>
  <p class="subheading">Dress up your pet and express your style! Spend your coins to unlock and equip accessories.</p>
  
  <div class="accessories-layout">
    <div class="pet-display">
      <h2>Your Pet</h2>
      {% if pet and pet.type.base_image %}
        <img src="{{ pet.type.base_image.url }}" alt="{{ pet.name }}">
      {% else %}
        <img src="{% static 'media/demoPet.png' %}" alt="Demo Pet">
      {% endif %}
      <h3>{% if pet %}{{ pet.name }}{% else %}Default Pet{% endif %}</h3>
    </div>
    
    <div class="accessories-content">
      <!-- navbar stuff -->
      <ul class="nav nav-tabs accessories-nav" id="accessoriesTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab" aria-controls="all" aria-selected="true">All</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="hats-tab" data-bs-toggle="tab" data-bs-target="#hats" type="button" role="tab" aria-controls="hats" aria-selected="false">Hats</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="tops-tab" data-bs-toggle="tab" data-bs-target="#tops" type="button" role="tab" aria-controls="tops" aria-selected="false">Tops</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="trousers-tab" data-bs-toggle="tab" data-bs-target="#trousers" type="button" role="tab" aria-controls="trousers" aria-selected="false">Trousers</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="shoes-tab" data-bs-toggle="tab" data-bs-target="#shoes" type="button" role="tab" aria-controls="shoes" aria-selected="false">Shoes</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="jackets-tab" data-bs-toggle="tab" data-bs-target="#jackets" type="button" role="tab" aria-controls="jackets" aria-selected="false">Jackets</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="extras-tab" data-bs-toggle="tab" data-bs-target="#extras" type="button" role="tab" aria-controls="extras" aria-selected="false">Extras</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="colour-tab" data-bs-toggle="tab" data-bs-target="#colour" type="button" role="tab" aria-controls="colour" aria-selected="false">Colour</button>
        </li>
      </ul>
      
      <!-- sort by option -->
      <div class="sort-options">
        <label for="sortSelect">Sort by: </label>
        <select id="sortSelect">
          <option value="price-asc">Price: Low to High</option>
          <option value="price-desc">Price: High to Low</option>
          <option value="popular">Most Popular</option>
          <option value="newest">Newest</option>
        </select>
      </div>
      
      <!-- accessories content tab -->
      <div class="tab-content" id="accessoriesTabContent" style="margin-top: 20px;">
        <!-- all -->
        <div class="tab-pane fade show active" id="all" role="tabpanel" aria-labelledby="all-tab">
          <div class="accessories-grid">
            {% for accessory in accessories.all %}
            <div class="accessory-card"
                 data-price="{{ accessory.price }}"
                 data-popular="{{ accessory.popularity|default:"0" }}"
                 data-newest="{{ accessory.created_at }}">
              {% if accessory.image %}
                <img src="{{ accessory.image.url }}" alt="{{ accessory.name }}">
              {% else %}
                <img src="{% static 'media/demoAccessory.png' %}" alt="Demo Accessory">
              {% endif %}
              <h3>{{ accessory.name }}</h3>
              <p>{{ accessory.description }}</p>
              <p><strong>Price:</strong> {{ accessory.price|default:"N/A" }} Coins</p>
              <a href="#" class="buy-btn">Buy Now</a>
            </div>
            {% empty %}
            <!-- sample cards if no accessories exist -->
            <div class="accessory-card" data-price="100" data-popular="50" data-newest="2025-01-01">
              <img src="{% static 'media/demoAccessory.png' %}" alt="Demo Accessory">
              <h3>Cap</h3>
              <p>Stylish cap for your pet.</p>
              <p><strong>Price:</strong> 100 Coins</p>
              <a href="#" class="buy-btn">Buy Now</a>
            </div>
            <div class="accessory-card" data-price="120" data-popular="40" data-newest="2025-01-01">
              <img src="{% static 'media/demoAccessory.png' %}" alt="Demo Accessory">
              <h3>Bucket Hat</h3>
              <p>Casual bucket hat.</p>
              <p><strong>Price:</strong> 120 Coins</p>
              <a href="#" class="buy-btn">Buy Now</a>
            </div>
            <div class="accessory-card" data-price="150" data-popular="60" data-newest="2025-01-01">
              <img src="{% static 'media/demoAccessory.png' %}" alt="Demo Accessory">
              <h3>Sneakers</h3>
              <p>Comfortable sneakers for daily adventures.</p>
              <p><strong>Price:</strong> 150 Coins</p>
              <a href="#" class="buy-btn">Buy Now</a>
            </div>
            <div class="accessory-card" data-price="80" data-popular="30" data-newest="2025-01-01">
              <img src="{% static 'media/demoAccessory.png' %}" alt="Demo Accessory">
              <h3>Graphic T-Shirt</h3>
              <p>Express your style with this T-Shirt.</p>
              <p><strong>Price:</strong> 80 Coins</p>
              <a href="#" class="buy-btn">Buy Now</a>
            </div>
            {% endfor %}
          </div>
        </div>
        <!-- additional category tabs (hats, tops, etc.) can be added -->
        <div class="tab-pane fade" id="hats" role="tabpanel" aria-labelledby="hats-tab">
          <div class="accessories-grid">
            <div class="accessory-card" data-price="100" data-popular="50" data-newest="2025-01-01">
              <img src="{% static 'media/demoAccessory.png' %}" alt="Cap">
              <h3>Cap</h3>
              <p>Classic cap.</p>
              <p><strong>Price:</strong> 100 Coins</p>
              <a href="#" class="buy-btn">Buy Now</a>
            </div>
            <div class="accessory-card" data-price="120" data-popular="45" data-newest="2025-01-01">
              <img src="{% static 'media/demoAccessory.png' %}" alt="Bucket Hat">
              <h3>Bucket Hat</h3>
              <p>Casual bucket hat.</p>
              <p><strong>Price:</strong> 120 Coins</p>
              <a href="#" class="buy-btn">Buy Now</a>
            </div>
            <!-- will add more options -->
          </div>
        </div>
      </div>
    </div>
  </div>
  <a href="{% url 'pets:mypet' %}" class="back-to-pet">Back to My Pet</a>
</div>
{% endblock %}