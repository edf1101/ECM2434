{% extends 'layout.html' %}
{% load static %}

{% block title %}Ecopet - @{{ user.username }}{% endblock %}

{% block extrahead %}
    <link rel="stylesheet" href="{% static 'css/styleAll.css' %}">
    <link rel="stylesheet" href="{% static 'users/css/profile.css' %}">
{% endblock %}

{% block content %}
    <div class="container mt-4">

        <div class="profile-header">
            <h1><u>{{ user.first_name }} {{ user.last_name }}'s Profile</u></h1>
            {% if user == request.user %}
                <a href="{% url 'users:edit' %}" class="text-decoration-none" title="Edit Profile">
                    <i class="bi bi-pencil-square fs-3 align-middle"></i>
                </a>
            {% endif %}
            <p>{{ user.profile.bio }}</p>
        </div>

        <div class="text-center mb-4">
            <span class="badge-custom"
                  style="background-color: #EFBF04;">‚ú® Points: {{ user.profile.points }} ‚ú®</span>
            <span class="badge-custom"
                  style="background-color: #f4573d;">üî• Streak: {{ user.streak.effective_streak }} üî•</span>
            <span class="badge-custom"
                  style="background-color: #2eccbf;">‚è±Ô∏è Last seen: {{ user.profile.last_active_string }} ‚è±Ô∏è</span>
            {% for badge in badges %}
                <span class="badge-custom"
                      style="background-color: {{ badge.colour }};">{{ badge.title }}</span>
            {% endfor %}
        </div>

        <section class="pet-card">
            <div class="pet-image-container">
                {% if pet %}
                    <h4 id="petName">{{ pet.name }}</h4>
                    {% if pet.type.name == "Axolotl" %}
                        <video id="petVideo" autoplay loop playsinline muted
                               style="max-width:220px;">
                            <source src="/media/pets/base_movs/axolotl/axolotl.webm"
                                    type="video/webm">
                            Your browser does not support the video tag.
                        </video>
                    {% elif pet.type.name == "Virginia Big-Eared Bat" %}
                        <video id="petVideo" autoplay loop playsinline muted
                               style="max-width:220px;">
                            <source src="/media/pets/base_movs/bat/bat.webm" type="video/webm">
                            Your browser does not support the video tag.
                        </video>
                    {% elif pet.type.name == "African Bush Elephant" %}
                        <video id="petVideo" autoplay loop playsinline muted
                               style="max-width:220px;">
                            <source src="/media/pets/base_movs/elephant/elephant.webm"
                                    type="video/webm">
                            Your browser does not support the video tag.
                        </video>
                    {% else %}
                        <img id="petImage" src="{% static 'media/demoPet.png' %}" alt="Demo Pet">
                    {% endif %}
                {% else %}
                    <h4 id="petName">Default Pet Name</h4>
                    <img id="petImage" src="{% static 'media/demoPet.png' %}" alt="Demo Pet">
                {% endif %}
            </div>

            <div class="vertical-divider"></div>

            <div class="pet-stats-container">
                <h5>Scores</h5>
                <p class="mt-3">
                    {% if pet %}
                        {{ pet.name }}'s score:
                        <span id="petPoints">{{ user.profile.points }}</span>
                    {% else %}
                        Your score: <span id="petPoints">{{ user.profile.points }}</span>
                    {% endif %}
                </p>
                <br>
                <h5>Health</h5>
                <div class="progress">
                    {% if pet %}
                        {% with health=pet.health %}
                            <div id="petHealthBar" class="progress-bar" role="progressbar"
                                 style="width: {{ health }}%;"
                                 aria-valuenow="{{ health }}"
                                 aria-valuemin="0" aria-valuemax="100">
                                {{ health }}%
                            </div>
                        {% endwith %}
                    {% else %}
                        <div id="petHealthBar" class="progress-bar" role="progressbar"
                             style="width: 50%;" aria-valuenow="50" aria-valuemin="0"
                             aria-valuemax="100">
                            50%
                        </div>
                    {% endif %}
                </div>
                <small id="petHealthText">
                    {% if pet %}
                        {% if pet.health > 80 %}
                            {{ pet.name }} is in excellent condition ‚Äì keep conquering challenges!
                        {% elif pet.health > 30 %}
                            {{ pet.name }} is holding on ‚Äì earn more points to boost its health.
                        {% else %}
                            {{ pet.name }} is in critical condition ‚Äì urgent care required!
                        {% endif %}
                    {% else %}
                        Your default pet is performing well.
                    {% endif %}
                </small>
            </div>
        </section>

        <div class="mb-4">
            <h1 class="display-5 text-center">Recently Completed Challenges</h1>
            {% for challenge in challenges %}
                <div class="alert alert-success" role="alert">
                    They reached the {{ challenge.feature_instance.name }} on
                    {{ challenge.reached_at|date:"F j, Y, g:i a" }}!
                </div>
                {% empty %}
                <p class="text-muted text-center">No challenges completed recently ‚Äì get out there
                    and earn those points!</p>
            {% endfor %}
        </div>
    </div>
{% endblock %}
